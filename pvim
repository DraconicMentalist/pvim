#!/usr/bin/env sh

# Get the path to pvim
export PVIM=$(dirname $(readlink -e -- "$0"))

# check if there is an init/what version it is
if [ -f $PVIM/config/init.lua ]; then
  INIT="-u $PVIM/config/init.lua"
elif [ -f $PVIM/config/init.vim ]; then
  INIT="-u $PVIM/config/init.vim"
fi

# Determine what Neovim to use
if [ -f $PVIM/nvim.appimage ]; then
  NV="$PVIM/nvim.appimage"
elif command -v nvim > /dev/null; then
  NV="nvim"
else
  $PVIM/pvim-update
  NV="$PVIM/nvim.appimage"
fi

#run Neovim with the local files
$NV --clean $INIT --cmd "so $PVIM/previm.lua" -c "so $PVIM/postvim.lua" $@
